@using Microsoft.AspNetCore.Routing
@using Nop.Plugin.Baramjk.PhotoPlatform.Areas.Admin.Models.CashierEvents
@using Nop.Web.Framework.Models.DataTables
@{
}

<div class="card-body">
    <div class="cards-group">
        <div class="card card-default">
            <div class="card-header">
                <h5 class="float-left">
                    @T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.Widget.CashierEvent.Title")
                </h5>
                <div class="card-tools float-right">
                    <button type="submit" id="btnAddNewActor"
                            onclick="OpenWindow('@(Url.Action("CashierAddPopUp", "CashierEvent", new { Model.EventId, RefreshBtnId = "btnRefreshCashiers" }))', 800, 800, true); return false;"
                            class="btn btn-primary">
                        <i class="fas fa-plus-square"></i>
                        @T("Admin.Common.AddNew")
                    </button>
                    <button type="submit" id="btnRefreshCashiers" style="display: none"></button>
                    <script>
                        $(document).ready(function () {
                            $('#btnRefreshCashiers').click(function () {
                                updateTable('#cashiers-events-grid');
                                return false;
                            });
                        });
                    </script>
                </div>
            </div>
            <div class="card-body">

                @await Html.PartialAsync("Table", new DataTablesModel
                {
                    Name = "cashiers-events-grid",
                    UrlRead = new DataUrl("List", "CashierEvent", new RouteValueDictionary
                    {
                        [nameof(Model.EventId)] = Model.EventId
                    }),
                    UrlUpdate = new DataUrl("Edit", "CashierEvent", null),
                    UrlDelete = new DataUrl("DeleteById", "CashierEvent", null),
                    Length = Model.PageSize,
                    LengthMenu = Model.AvailablePageSizes,
                    ColumnCollection = new List<ColumnProperty>
                    {
                        new(nameof(CashierEventsItemModel.CashierEmail))
                        {
                            Width = "100",
                            Title = T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.CashierEvents.CashierEmail").Text,
                            ClassName = NopColumnClassDefaults.CenterAll
                        },
                        new ColumnProperty(nameof(CashierEventsItemModel.CashierPictureUrl))
                        {
                            Title = T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.CashierEvents.CashierPictureUrl").Text,
                            Width = "80",
                            ClassName = NopColumnClassDefaults.CenterAll,
                            Render = new RenderPicture()
                        },


                        new(nameof(CashierEventsItemModel.Active))
                        {
                            Width = "50",
                            Title = T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.CashierEvents.Active").Text,
                            ClassName = NopColumnClassDefaults.CenterAll,
                            Editable = true,
                            EditType = EditType.Checkbox,
                            Render = new RenderBoolean(),
                        },
                        new(nameof(CashierEventsItemModel.IsRefundPermitted))
                        {
                            Width = "50",
                            Title = T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.CashierEvents.IsRefundPermitted").Text,
                            ClassName = NopColumnClassDefaults.CenterAll,
                            Editable = true,
                            EditType = EditType.Checkbox,
                            Render = new RenderBoolean(),
                        },


                        new(nameof(CashierEventsItemModel.Id))
                        {
                            Title = T("Admin.Common.Edit").Text,
                            Width = "100",
                            ClassName = NopColumnClassDefaults.Button,
                            Render = new RenderButtonsInlineEdit()
                        },

                        new(nameof(CashierEventsItemModel.Id))
                        {
                            Title = T("Admin.Common.Delete").Text,
                            Width = "80",
                            ClassName = NopColumnClassDefaults.Button,
                            Render = new RenderButtonRemove(T("Admin.Common.Delete").Text)
                        }
                    }
                })

            </div>
        </div>
        <script>


            $(document).ready(function () {
                $('#btnRefreshCashiers').click(function () {
                    updateTable("cashiers-events-grid");
                    return false;
                });
            });


            function renderChangeBalanceButton(data, type, row, _meta) {

                const baseUrl = '@Url.Action("ChangeBalance", "CashierEvent", new { area = "Admin" })';
                const url = baseUrl + '?cashierEventId=' + row.Id + "&RefreshBtnId=btnRefreshCashiers";

                return '<button type="button" class="btn btn-sm btn-primary" onclick="openChangeBalancePopup(\'' + url + '\')">' +
                    '@T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.CashierEvents.ChangeBalance").Text' +
                    '</button>';
            }

            function openChangeBalancePopup(url) {
                OpenWindow(url, 800, 600, true);
            }

        </script>
    </div>
</div>