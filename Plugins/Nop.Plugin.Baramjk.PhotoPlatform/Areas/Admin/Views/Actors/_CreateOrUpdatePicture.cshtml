@using Microsoft.AspNetCore.Routing
@using Nop.Plugin.Baramjk.PhotoPlatform.Areas.Admin.Models.Actors
@using Nop.Web.Framework.Models.DataTables
@model ActorViewModel

@{
}

@if (Model.Id > 0)
{
    <div class="container-fluid">
        <div class="form-horizontal">
            <div class="card card-default">
                <div class="card-header">
                    @T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.Actor.Pictures.Header.AddNew")
                </div>
                <div class="card-body">
                    <script>
                        $(document).ready(function () {
                            $('#addActorPicture').click(function () {
                                const pictureId = $("#@Html.IdFor(model => model.AddActorPictureItemModel.PictureId)").val();
                                const displayOrder = $("#@Html.IdFor(model => model.AddActorPictureItemModel.DisplayOrder)").val();
                                if (pictureId === "0") {
                                    $("#addActorPictureAlert").click();

                                }

                                const postData = {
                                    pictureId: pictureId,
                                    displayOrder: displayOrder,
                                    actorId: '@Model.Id'
                                };

                                $.ajax({
                                    cache: false,
                                    type: "POST",
                                    url: "@(Url.Action("ActorPictureAdd", "Actor"))",
                                    data: postData,
                                    success: function (data, textStatus, jqXHR) {
                                        if (!data.Result) {
                                            return;
                                        }
                                        updateTable('#actor-pictures-grid');
                                    },
                                    error: function (jqXHR, textStatus, errorThrown) {
                                        $("#ActorPictureAddAlert").click();
                                    },
                                    complete: function (jqXHR, textStatus) {
                                        $('#addActorPicture').attr('disabled', false);
                                    }
                                });
                            })
                        })


                    </script>
                    <div class="form-group row">
                        <div class="col-md-3">
                            <nop-label asp-for="AddActorPictureItemModel.PictureId"/>
                        </div>
                        <div class="col-md-9">
                            <nop-editor asp-for="AddActorPictureItemModel.PictureId"/>
                            <span asp-validation-for="AddActorPictureItemModel.PictureId"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-md-3">
                            <nop-label asp-for="AddActorPictureItemModel.DisplayOrder"/>
                        </div>
                        <div class="col-md-9">
                            <nop-editor asp-for="AddActorPictureItemModel.DisplayOrder"/>
                            <span asp-validation-for="AddActorPictureItemModel.DisplayOrder"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-md-9 offset-md-3">
                            <button type="button" id="addActorPicture"
                                    class="btn btn-primary">@T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.Actor.Pictures.Button.AddNew")</button>
                        </div>
                    </div>
                </div>
                <div class="card-body">

                    @await Html.PartialAsync("Table", new DataTablesModel
                    {
                        Name = "actor-pictures-grid",
                        UrlRead = new DataUrl("ActorPictureList", "Actor", new RouteValueDictionary { [nameof(Model.ActorPictureSearchModel.ActorId)] = Model.Id }),
                        UrlDelete = new DataUrl("ActorPictureDelete", "Actor", null),
                        UrlUpdate = new DataUrl("ActorPictureUpdate", "Actor", null),
                        Length = Model.ActorPictureSearchModel.PageSize,
                        LengthMenu = Model.ActorPictureSearchModel.AvailablePageSizes,
                        ColumnCollection = new List<ColumnProperty>
                        {
                            new ColumnProperty(nameof(ActorPictureItemModel.PictureUrl))
                            {
                                Title = T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.ActorPicture.PictureUrl").Text,
                                Width = "200",
                                ClassName = NopColumnClassDefaults.CenterAll,
                                Render = new RenderPicture()
                            },
                            new ColumnProperty(nameof(ActorPictureItemModel.DisplayOrder))
                            {
                                Title = T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.ActorPicture.DisplayOrder").Text,
                                Width = "150",
                                ClassName = NopColumnClassDefaults.CenterAll,
                                Editable = true,
                                EditType = EditType.Number
                            },

                            new ColumnProperty(nameof(ActorPictureItemModel.Id))
                            {
                                Title = T("Admin.Common.Edit").Text,
                                Width = "200",
                                ClassName = NopColumnClassDefaults.Button,
                                Render = new RenderButtonsInlineEdit()
                            },
                            new ColumnProperty(nameof(ActorPictureItemModel.Id))
                            {
                                Title = T("Admin.Common.Delete").Text,
                                Width = "100",
                                Render = new RenderButtonRemove(T("Admin.Common.Delete").Text),
                                ClassName = NopColumnClassDefaults.Button
                            }
                        }
                    })

                </div>
            </div>

        </div>
    </div>
}

else
{
    <div class="container-fluid">
        <div class="card card-default">
            <div class="card-header">
                @T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.Actor.Pictures")
            </div>
            <div class="card-body" id="actor-pictures-area">
                @T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.Actor.Pictures.SaveBeforeEdit")
            </div>
        </div>
    </div>
}

<nop-alert asp-alert-id="addActorPictureAlert" asp-alert-message="@T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.Actor.Pictures.Alert.AddNew")"/>
<nop-alert asp-alert-id="ActorPictureAddAlert" asp-alert-message="@T("Nop.Plugin.Baramjk.PhotoPlatform.Admin.Actor.Pictures.Alert.PictureAdd")"/>